<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background-color: #1e1e2e;
      color: #cdd6f4;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .navbar {
      background-color: #181825 !important;
      border-bottom: 1px solid #313244;
    }
    .gmail-header {
      background-color: #181825;
      border-bottom: 1px solid #313244;
      padding: 1rem 0;
    }
    .gmail-logo {
      font-size: 1.5rem;
      font-weight: 500;
      color: #cdd6f4;
    }
    .gmail-search {
      background-color: #313244;
      border: 1px solid #45475a;
      border-radius: 24px;
      padding: 0.5rem 1rem;
      width: 100%;
      max-width: 600px;
      color: #cdd6f4;
    }
    .gmail-search:focus {
      outline: none;
      border-color: #89b4fa;
      box-shadow: 0 0 0 0.25rem rgba(137, 180, 250, 0.25);
    }
    .gmail-sidebar {
      background-color: #181825;
      border-right: 1px solid #313244;
      min-height: calc(100vh - 120px);
      padding: 1rem;
    }
    .sidebar-btn {
      background-color: #313244;
      border: 1px solid #45475a;
      color: #cdd6f4;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      text-align: left;
      width: 100%;
      font-size: 0.9rem;
    }
    .sidebar-btn:hover {
      background-color: #45475a;
      color: #cdd6f4;
    }
    .sidebar-btn.active {
      background-color: #89b4fa;
      border-color: #89b4fa;
      color: #11111b;
    }
    .email-list {
      background-color: #1e1e2e;
    }
    .email-item {
      background-color: #181825;
      border: 1px solid #313244;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .email-item:hover {
      background-color: #313244;
      border-color: #89b4fa;
      transform: translateY(-1px);
    }
    .email-item.unread {
      border-left: 4px solid #f38ba8;
      background-color: #22212c;
    }
    .email-sender {
      font-weight: 600;
      color: #cdd6f4;
      font-size: 0.95rem;
    }
    .email-subject {
      color: #cdd6f4;
      margin: 0.25rem 0;
      font-size: 0.9rem;
    }
    .email-preview {
      color: #bac2de;
      font-size: 0.85rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .email-time {
      color: #bac2de;
      font-size: 0.8rem;
      text-align: right;
    }
    .vulnerability-badge {
      background-color: #f38ba8;
      color: #11111b;
      font-size: 0.7rem;
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      text-transform: uppercase;
      font-weight: bold;
    }
    .demo-notice {
      background-color: #313244;
      border: 1px solid #f38ba8;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .demo-notice h6 {
      color: #f38ba8;
    }
    .email-count {
      background-color: #89b4fa;
      color: #11111b;
      border-radius: 12px;
      padding: 0.2rem 0.5rem;
      font-size: 0.7rem;
      font-weight: bold;
      float: right;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="/demo1">
        <i class="bi bi-arrow-left me-2"></i>Back to AutoFinder
      </a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="/demo1/docs">üìã Documentation</a>
        <a class="nav-link" href="/">‚Üê Back to Demos</a>
      </div>
    </div>
  </nav>

  <!-- Gmail-style Header -->
  <div class="gmail-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-3">
          <div class="gmail-logo">
            <i class="bi bi-envelope-fill me-2"></i>AutoFinder Mail
            <span class="vulnerability-badge ms-2">HTML Injection Demo</span>
          </div>
        </div>
        <div class="col-md-6">
          <input type="text" class="gmail-search" placeholder="Search emails..." disabled>
        </div>
        <div class="col-md-3 text-end">
          <small class="text-muted">Demo Email System</small>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <!-- Gmail-style Sidebar -->
      <div class="col-md-2 gmail-sidebar">
        <button class="sidebar-btn active">
          <i class="bi bi-inbox me-2"></i>Inbox
          <% if (emails.length > 0) { %>
            <span class="email-count"><%= emails.length %></span>
          <% } %>
        </button>
        <button class="sidebar-btn">
          <i class="bi bi-send me-2"></i>Sent
        </button>
        <button class="sidebar-btn">
          <i class="bi bi-file-earmark-text me-2"></i>Drafts
        </button>
        <button class="sidebar-btn">
          <i class="bi bi-star me-2"></i>Starred
        </button>
        <button class="sidebar-btn">
          <i class="bi bi-trash me-2"></i>Trash
        </button>

        <hr class="my-3" style="border-color: #30363d;">
        
        <div class="demo-notice">
          <h6><i class="bi bi-exclamation-triangle me-2"></i>Demo Notice</h6>
          <p class="mb-0 small">This email system demonstrates HTML injection vulnerabilities. All emails shown contain unescaped user input.</p>
        </div>
      </div>

      <!-- Email List -->
      <div class="col-md-10 email-list p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h5 class="mb-0">
            <i class="bi bi-inbox me-2"></i>Inbox 
            <span class="text-muted">(<%= emails.length %> emails)</span>
          </h5>
          <div>
            <button class="btn btn-outline-primary btn-sm me-2">
              <i class="bi bi-arrow-clockwise me-1"></i>Refresh
            </button>
            <button class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-funnel me-1"></i>Filter
            </button>
          </div>
        </div>

        <% if (emails.length === 0) { %>
          <div class="text-center py-5">
            <i class="bi bi-inbox" style="font-size: 3rem; color: #30363d;"></i>
            <h6 class="text-muted mt-3">No emails yet</h6>
            <p class="text-muted">Create some saved searches with HTML injection to see emails appear here.</p>
            <a href="/demo1" class="btn btn-primary">
              <i class="bi bi-plus me-2"></i>Create Search
            </a>
          </div>
        <% } else { %>
          <% emails.reverse().forEach((email, index) => { %>
            <div class="email-item unread" onclick="viewEmail(<%= email.id %>)">
              <div class="row align-items-center">
                <div class="col-md-3">
                  <div class="email-sender">
                    <i class="bi bi-building me-2"></i><%= email.fromName %>
                  </div>
                  <div class="text-muted" style="font-size: 0.8rem;"><%= email.from %></div>
                </div>
                <div class="col-md-6">
                  <div class="email-subject">
                    <strong><%= email.subject %></strong>
                    <% if (email.searchName) { %>
                      <span class="vulnerability-badge ms-2">HTML INJECTION</span>
                    <% } %>
                  </div>
                  <div class="email-preview">
                    To: <%= email.toName %> (<%= email.to %>) - Search: <%= email.searchName || 'Unnamed' %>
                  </div>
                </div>
                <div class="col-md-3 email-time">
                  <div><%= new Date(email.timestamp).toLocaleDateString() %></div>
                  <div><%= new Date(email.timestamp).toLocaleTimeString() %></div>
                  <% if (email.triggerCar) { %>
                    <div class="text-info" style="font-size: 0.75rem;">
                      <i class="bi bi-car-front me-1"></i><%= email.triggerCar %>
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
          <% }); %>
        <% } %>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function viewEmail(emailId) {
      window.location.href = `/demo1/emails/${emailId}`;
    }
    
    // Add some Gmail-like interactions
    document.querySelectorAll('.email-item').forEach(item => {
      item.addEventListener('mouseenter', function() {
        this.style.boxShadow = '0 2px 8px rgba(31, 111, 235, 0.2)';
      });
      
      item.addEventListener('mouseleave', function() {
        this.style.boxShadow = 'none';
      });
    });
  </script>
</body>
</html>